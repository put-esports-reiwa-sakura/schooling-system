<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <meta name="format-detection" content="telephone=no">
    <title>令和さくら高等学院-イベント</title>
    <!-- 上から Roboto , Zen Maru Gothic , Noto Sans Japanese , english- Poppins -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap">
	<style>
	body {
		background-color: #202124;
		color: #ffffff;
		font-family: 'Zen Maru Gothic', sans-serif;
	}
	.zentaikoutei #zentaikoutei-title {
		position: sticky;
		top: 0%;
		text-align: center;
		align-items: center;
		font-size: 170%;
		padding: 0px;
		background-color: rgba(34,34,34,0.5);
	}
	.zentaikoutei #zentaikoutei-title-comment{
		font-size:1.3em;
		background-color: #444;
		border-radius: 8px;
		padding: 20px;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
	}
	.zentaikoutei .zentaikoutei-main {
		text-align: center;
		align-items: center;
	}
	.zentaikoutei-dropdown-list {
		flex: 1;
		font-size: 16px;
		padding: 8px;
		border: 2px solid #4285f4;
		background-color: #202124;
		color: #ffffff;
		border-radius: 8px;
	}

	.zentaikoutei-custom-button {
		font-size: 16px;
		padding: 10px 20px;
		background-color: #4285f4;
		color: #ffffff;
		border: none;
		border-radius: 8px;
		cursor: pointer;
		margin-top: 10px;
	}
	
	.zentaikoutei-content div {
		max-width: 600px;
		margin: 10px auto;
		background-color: #444;
		border-radius: 8px;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
		padding: 20px;
		font-family: 'Zen Maru Gothic', sans-serif;
	}
	
	div[data-timeslot] div {
		background-color: dimgray;
	}
	div[data-timeslot] h2 {
		position:sticky;
		top: 14%;
		background-color: rgb(68 68 68 / 50%);
	}

	h1{font-size:2em;margin: 0em;}
	h2{font-size:1.5em;margin: 0em;}
	h3{font-size:1.5em;margin: 0em;} 
	p{font-size:1.17em;margin: 0em;} 
	h4{font-size:1em;margin: 0em;}
	h5{font-size:0.83em;margin: 0em;}
	h6{font-size:0.67em;margin: 0em;}
	</style>
</head>
<body>
	<div class="zentaikoutei">
	<div class="zentaikoutei-main">
		<p>iPhone13miniなど、画面の縦が短いモデルはスクロールした際、この上のボタンが隠れてしまうことがあります。ページ変更ボタンはこの上にあります。</p>
		<select class="zentaikoutei-dropdown-list">
			<option value="1日目">1日目</option>
			<option value="2日目">2日目</option>
			<option value="3日目">3日目</option>
			<option value="4日目">4日目</option>
		</select>
		<button class="zentaikoutei-custom-button" id="zentaikoutei-loadDataButton">データを読み込む</button>
	</div>
	<div id="zentaikoutei-title"></div>
	<div id="zentaikoutei-title-comment">選択して押してください。</div>
    <div class="zentaikoutei-content" id="zentaikoutei-eventDisplay"><div><h1>読み込み中...</h1></div></div>
	</div>
    <script>
        var jsonDataUrl = 'https://raw.githubusercontent.com/put-esports-reiwa-sakura/schooling-system/main/spreadsheetdata.json';
		var dropdown = document.querySelector(".zentaikoutei-dropdown-list");
		var eventDisplay = document.getElementById("zentaikoutei-eventDisplay");
		var loadDataButton = document.getElementById("zentaikoutei-loadDataButton");
		var selectedValue = localStorage.getItem('selectedValue'); // ローカルストレージから選択された値を取得

		// ページを再読み込んだ際に、保存された値があればそれをドロップダウンにセットします（なければデフォルトの値）
		if (selectedValue) {
		  dropdown.value = selectedValue;
		}

		// 以下の関数はタイトルの変更と画像の追加、およびメッセージの表示を行います
		function updateDisplay(selectedValue) {
		  // コードスニペット1：タイトルの変更と画像の追加
		  var dateMap = {
			"1日目": "【10月31日（火）１日目",
			"2日目": "【11月1日（水）２日目",
			"3日目": "【11月2日（木）３日目",
			"4日目": "【11月3日（金）４日目"
		  };
		  var formattedValue = dateMap[selectedValue];

		  var titleElement = document.getElementById("zentaikoutei-title");
		  titleElement.innerHTML = formattedValue + "】";

		  var imageElement = document.createElement("img");
		  imageElement.src = "https://lh3.googleusercontent.com/fife/AK0iWDzJlQY5QnJLpl5yH1EM98Iq8hrvwOfv3Vy2-6rP3uGi3hSqu7KCz7HaWsfJ8ZCAivEbSAUdnSMf1te4kLUfB-AuVw68nG_YurRRXcGXktRTE54ksy-_x5BeP7C9PtgNn3_4hKdzdVbEN4vkY_RmIM9wY-8LIfQqGg7q_gmR5ze6wv34qUVXqtv9w7OOjTlCqG4ZSJp7ZLpXMrqDivMg7HNPvqlowwFfScQBBpeodb_asL-sdnC6YmQRRPAvIg5qlyfGwqBi4uUICo4F2H7aAGMjTWqapVpMSIhLqA66JFbMecW8kWZ-Ww9PaE0b48PX0hkxY1Nmw-g4k4KT1UiZxJ2c2W39HN_NPekoZLhiYKrNpXf5jwqaA7BE6pV9WyCd3sKNvCKAVi1mta4VreuhweEsOGPQpm4LAHU8yt54nxR9kjJiSxrDeu24Me3wiyWG1YS8a_0CEAUjJatcl9cgLx0HWMSYxvD9uOo2eSlIiQuBPx3FmvXZN7EzPWniDwG3QejXpfCvPir1DNI4KC8-DywDoeTr2M6uJ37djvR0I3kWXvE931_RVRhYAa5lavK1jmaG3TOPZQExX6yzOJfSF1Wv7wuX5qhmZ7e4njQXdEPUv6HdntHQ8mU-PpF8R6cQpf2oPeK7Gx1Q4q2ERkDb9O1Y8p4yUwtjATOyJqVEchd6ak19B6qwWCL3zZ0UtUKHM-s4IN_jd4aECUw-KrSsUa75IDtHY2qHXoCoC8xebrpxKsZCUz6_YNq8xHgPxBhtE6smGskSZWAIOYaB-ei7J-zRUDs2aiXBr0tcXpEF6Kg8VMIEFdBdRyrGRqDfqG7xIX3EMkKcljPxaUFZJhA7fYdArHSm8IihP77OiOnvLh4wo5USLpqGZ-q8xKSdDEJ1bCs7tN4og0pDZmQTbw8-ESZ7ZoE6YLauUKIn0AfTPHsw32nbEME11i8VZHZZHAt76wFlYD-EmA4A0dMcLMinC3gDKn3FNgiCZXBCaM3yCiyhuIQ8Z0-JF7yuLg_giv6YlpmV2DgxC24TuSS1ol93v5GkpnofBy4RH8R25WEduTKx5nynF_bn-2vk6b11PeiAkqDYBe8okqOrSQYWMzvq08wxSRAYEAODaM0fjFIi0GV41neNl-dZB1vrSN_uvplkrH8Wx8gy_nghj1iHsN0QrvgYofEhZa0D_DzG05HzQpECD7Yb_JmIl10k9hUcYWZgu1exhIqNO3PfGHf1MwAV61Q4YBqbdV3Xx93dRNDvyJ9cUH6M_rrq58MKuQ9fg1R6hVHhzXJ3EQm7g45CHh1oMA-P2h60NUIHwq2x0pTAEvXIHR8vurM9LEwQn5bCBvX9Ec7mvPkgH_7becJynDi9gCt7xHyq6NKqCjpvlUuOo9kG-AtkIbyVgpucD5xub4hEIsG3EA8zXlY50VekkRc9-2W3bvnxNETpsbCL1Hpd1Bil0A5S2D_wtAdb_mqVaBiYpXhIej2lytdk0bevFTrnnEvvsLnGjGc3robkuodIDI7vMtL1LngGWLuZBLq6hCSOEw5xgSe30EXhWINfX7MWmj4=w2000-h3342"; // 画像のパスを設定
		  imageElement.alt = "説明のない明蓬館の画像の説明画像"; // 画像の説明を設定
		  imageElement.style.maxWidth = "100%";
		  imageElement.style.height = "auto";

		  titleElement.appendChild(document.createElement("br")); // 改行追加
		  titleElement.appendChild(imageElement); // 画像追加

		  // コードスニペット2：メッセージの表示
		  var message = "";
		  switch (selectedValue) {
			case "1日目":
			  message = "※授業内容、授業時間は当日変更することがあります。<br>ページ上部にある[スクーリング詳細]→[各教科の必要な荷物]に詳しい内容があります。<br><br>※朝食食べない人へ。もちません。昼食食べられるのは飛行機乗った後です。";
			  break;
			case "2日目":
			  message = "※授業内容、授業時間は当日変更することがあります。<br>ページ上部にある[スクーリング詳細]→[各教科の必要な荷物]に詳しい内容があります。";
			  break;
			case "3日目":
			  message = "※授業内容、授業時間は当日変更することがあります。<br>ページ上部にある[スクーリング詳細]→[各教科の必要な荷物]に詳しい内容があります。";
			  break;
			case "4日目":
			  message = "※授業内容、授業時間は当日変更することがあります。<br>ページ上部にある[スクーリング詳細]→[各教科の必要な荷物]に詳しい内容があります。";
			  break;
		  }

		  document.getElementById("zentaikoutei-title-comment").innerHTML = message;
		}

		// ページ読み込み時にも処理を実行
		if (selectedValue) {
		  updateDisplay(selectedValue); // ドロップダウンの値に基づいて表示を更新
		  loadData(); // loadData() 関数を実行
		}

		// ボタンクリック時の処理
		loadDataButton.addEventListener("click", function() {
		  selectedValue = dropdown.value; // ドロップダウンの選択値を取得
		  localStorage.setItem('selectedValue', selectedValue); // 選択された値をローカルストレージに保存
		  updateDisplay(selectedValue); // タイトルと画像の表示およびメッセージの表示を更新
		  loadData(); // loadData() 関数を実行
		});

		// 以下は、残りのコード（getColorForYear と loadData 関数）をそのまま使用します
		function getColorForYear(year) {
			switch (year) {
				case "1年生": return "#ff9287";
				case "2年生": return "#ffe497";
				case "3年生": return "#8ab6ff";
				case "対象のみ": return "#76ff8e";
			}
		}
		function loadData() {
			if (selectedValue !== "") {
			fetch(jsonDataUrl)
				.then(response => {
				  if (!response.ok) {
					if (response.status === 500) {
					  throw new Error("サーバーエラーが発生しました。");
					} else if (response.status === 403) {
					  throw new Error("クロスドメイン制約によりデータを取得できません。");
					} else if (response.status === 503) {
					  throw new Error("サービスが利用不可です。");
					} else {
					  throw new Error("不明なエラーが発生しました。");
					}
				  }
				  return response.json();
				})
				.then(data => {
					var matchingData = data.filter(item => item.B === selectedValue);
					eventDisplay.innerHTML = "";
						if (matchingData.length > 0) { //メイン処理
							matchingData.forEach(function(item) {
								var displayContent = "";
								if (item.L === "特別" || item.L === "お知らせ" || item.L === "常時表示") {
									var divElement = document.createElement("div"); // ここで新しい div 要素を生成
									if (item.F !== "") {displayContent += "<h2>" + item.F + "</h2>";}
									if (item.G !== "") {displayContent += "<p>" + item.G + "<br>";}
									if (item.H !== "") {displayContent += item.H + "<br>";}
									if (item.I !== "") {displayContent += item.I + "<br>";}
									if (item.J !== "") {displayContent += item.J + "</p>";}

									divElement.innerHTML = displayContent;
									eventDisplay.appendChild(divElement); // div 要素を追加
								} else if (item.L === "ok") {
									// パターン2: "ok"の場合
									var divElement = document.createElement("div"); // ここで新しい div 要素を生成
									if (item.C !== "") {displayContent += "<h2>" + item.C + " ";}
									if (item.D !== "") {displayContent += item.D + "～";}
									if (item.E !== "") {displayContent += item.E + "</h2>";}
									if (item.F !== "") {displayContent += "<p>" + item.F + " 対象の ";}
									if (item.H !== "") {displayContent += item.H + "<br>";}
									if (item.G !== "") {displayContent += "場所：" +　item.G + "";}
									if (item.I !== "") {displayContent += "<br><span style='color: #ffcf41;'>注意：" + item.I + "</span></p>";}
									divElement.innerHTML = displayContent;
									eventDisplay.appendChild(divElement); // div 要素を追加
								} else {
									var timeSlotDiv = document.querySelector(`div[data-timeslot="${item.C}"]`); // 時限目に対応するdivを検索

									if (!timeSlotDiv) {
										// 新しい時限目のdivを生成
										timeSlotDiv = document.createElement("div");
										timeSlotDiv.setAttribute("data-timeslot", item.C); // data-timeslot属性を設定

										// 時限目のヘッダーを設定
										timeSlotDiv.innerHTML = `<h2>${item.C} ${item.D}～${item.E}</h2>`;

										eventDisplay.appendChild(timeSlotDiv); // 時限目のdivを追加
									}

									// 各授業情報を表示
									var courseDiv = document.createElement("div");
									if (item.F !== "") {displayContent += `<h3><span style='color: ${getColorForYear(item.F)}'>${item.F}</span> ${item.H}</h3>`;}
									if (item.G !== "") {displayContent += "<p>場所：" + item.G + "<br>";}
									if (item.P !== "") {displayContent += "持ち物：" + item.P + "<br><br>" ;}
									if (item.N !== "") {displayContent += "タイトル：" + item.N + "<br><br>";}
									if (item.O !== "") {displayContent += item.O ;}
									if (item.I !== "") {displayContent += "<br><br><span style='color: #ffcf41;'>注意：" + item.I + "</span></p>";}
									courseDiv.innerHTML = displayContent;
									timeSlotDiv.appendChild(courseDiv);

									// グループのフッターを生成
									if (!timeSlotDiv.querySelector(".footer")) {
										var footerDiv = document.createElement("div");
										footerDiv.className = "footer";
										timeSlotDiv.appendChild(footerDiv);
									}

									// グループのフッターにキーJの値を表示
									function escapeHTML(html) {
										const div = document.createElement('div');
										div.textContent = html;
										return div.innerHTML;
									}
									timeSlotDiv.querySelector(".footer").innerHTML = `<h3>対象ではない人の部屋	</h3>${escapeHTML(item.J)}`;

									// フッターをグループ内の一番下に配置
									timeSlotDiv.appendChild(timeSlotDiv.querySelector(".footer"));
								}
							});
						} else {
							eventDisplay.innerHTML = "<div>選択した日にちに関連する情報が見つかりません。</div>";
						}
					})
					.catch(error => {
				  // エラーメッセージを表示するための div 要素を作成
				  var errorDiv = document.createElement("div");
				  
				  // エラーメッセージを判別し、適切なメッセージを設定
				  if (error.message === "Failed to fetch") {
					errorDiv.textContent = "ネットワークが不安定です。インターネットの接続を確認してください。";
				  } else if (error.message === "Network Error") {
					errorDiv.textContent = "ネットワークエラーが発生しました。再度お試しください。";
				  } else if (error.message === "Request timeout") {
					errorDiv.textContent = "アクセス数増加が原因だと思われますが、サーバーからの応答が遅くなっています。もう一度試してみてください。";
				  } else if (error.message === "Connection refused") {
					errorDiv.textContent = "申し訳ございません。サーバーへの接続が拒否されてしまいました。お手数ですがしばらくした後再度お試しください。";
				  } else if (error.message === "No internet connection") {
					errorDiv.textContent = "インターネットに接続されていません。インターネット接続を確認してください。";
				  } else if (error.message === "DNS resolution failed") {
					errorDiv.textContent = "ホスト名を解決できません。ネットワーク設定を確認してください。";
				  } else if (error.message.includes("CORS policy") || error.message.includes("Cross-Origin Request Blocked")) {
					errorDiv.textContent = "まさか...このエラーを表示させたアンタ...ハッカー..."; // クロスオリジンリクエストがブロックされました。この操作は許可されていません。
				  } else {
					errorDiv.textContent = "想定外のエラーが発生しました: " + error.message +"お手数ですが、再度お試しください。";
				  }

				  errorDiv.style.color = "red"; // テキストの色
				  errorDiv.style.fontWeight = "bold"; // テキストの太さ
				  errorDiv.style.fontSize = "1.2em"; // テキストのフォントサイズ
				  errorDiv.style.textAlign = "center"; // テキストの配置
				  errorDiv.style.marginTop = "20px"; // 上部の余白

				  // 既存の内容をクリア
				  eventDisplay.innerHTML = "";

				  // エラーメッセージを zentaikoutei-eventDisplay に追加
				  eventDisplay.appendChild(errorDiv);
				});
			}
		}
		window.parent.postMessage('setHeightTo40em', '*');
    </script>
</body>
</html>
